{% extends "home_base.html" %}
{% load wagtailcore_tags %}
{% load static %}
{% load filters %}
{% load top_entities elections_lookup home_page commissioners %}
{% block body_class %}template-{{ self.get_verbose_name | slugify }}{% endblock %}

{% block content %}
  <section class="hero hero--home" aria-labelledby="hero-heading">
    <div class="container">
      <div class="hero__content">
        <h2 id="hero-heading">Protecting the integrity of the campaign finance process</h2>
        <a class="button button--thin-border" href="/about">More about the FEC</a>
      </div>
    </div>
  </section>

  {% home_page_banner_announcement %}
  
  <section class="slab">
    {% comment %}
    Below is for featured icon+links in Wagtail html block only...for now. 
    {% endcomment %}
    {% for block in self.body %}
      {% if block.block_type == "html" %}
        <div class="container">
         {{ block.value }}
        </div>
      {% endif %}
    {% endfor %}
    <div class="container">
      <div class="heading--section heading--with-action">
        <h2 class="heading__left">News and announcements</h2>
        <a class="button--cta button--updates heading__right" href="/updates">All news</a>
      </div>

      {% home_page_news %}

      <div class="heading--section heading--with-action">
        <h2 class="heading__left">Events and deadlines</h2>
        <a class="button--cta heading__right button--calendar" href="/calendar">Full calendar</a>
      </div>
      <ul class="grid grid--4-wide grid--flex t-sans">
        <li class="grid__item grid__item--with-button">
          <div class="t-bold">Next open commission meeting:</div>
          <div class="js-next-commission-meeting"></div>
          <a class="button button--alt button--updates" href="/meetings">All meetings</a>
        <li class="grid__item grid__item--with-button">
          <div class="t-sans t-bold">Next filing deadline:</div>
          <div class="js-next-filing-deadline"></div>
          <a class="button button--alt button--calendar" href="/calendar/?calendar_category_id=25&calendar_category_id=26&calendar_category_id=27">All filing deadlines</a>
        </li>
        <li class="grid__item grid__item--with-button">
          <div class="t-sans t-bold">Next training or conference:</div>
          <div class="js-next-training-or-conference"></div>
          <a class="button button--alt button--calendar" href="/calendar/?calendar_category_id=33&calendar_category_id=34">All outreach</a>
        </li>
        <li class="grid__item grid__item--with-button">
          <div class="t-sans t-bold">Next public comment deadline:</div>
          <div class="js-next-public-comment-deadline"></div>
          <a class="button button--alt button--calendar" href="/calendar/?calendar_category_id=23">All legal events</a>
        </li>
      </ul>
    </div>
  </section>

  <section class="slab slab--home slab--neutral">
    <div class="container">

    {% elections_lookup request %}

      <div class="grid grid--3-wide grid--no-border slab--spacious-margin slab--ruled u-padding--top">
        <div class="grid__item">
          <div class="icon-heading icon-heading--direction-sign-circle primary">
            <p class="t-sans t-small icon-heading__text"><a href="/introduction-campaign-finance/understanding-ways-support-federal-candidates/">Understand ways to support federal candidates</a></p>
          </div>
        </div>
        <div class="grid__item">
          <div class="icon-heading icon-heading--financial-document primary">
            <p class="t-sans t-small icon-heading__text"><a href="/introduction-campaign-finance/how-to-research-public-records/">Learn more about using the FEC's campaign finance data</a></p>
          </div>
        </div>
        <div class="grid__item">
          <div class="icon-heading icon-heading--election-circle primary">
            <p class="t-sans t-small icon-heading__text"><a href="/introduction-campaign-finance/election-and-voting-information/">Find election results and voting information</a></p>
          </div>
        </div>
      </div>

    {% raising_spending request %}

    </div>
  </section>
  <section class="slab">
    <div class="container">
      <h1>Commissioners</h1>
      {% current_commissioners '3' %}
    </div>
  </section>
{% endblock %}

{% block extra_js %}
<script>
  var canSkipPolyfills = ('fetch' in window && 'assign' in Object);
  if (!canSkipPolyfills) {
    var pfScriptElem = document.createElement('script');
    pfScriptElem.async = false;
    pfScriptElem.defer = false;
    pfScriptElem.src = "{% asset_for_js 'polyfills.js' %}";
    document.head.appendChild(pfScriptElem);
  }
</script>
<script defer src="{% asset_for_js 'home.js' %}"></script>
<script defer src="{% asset_for_js 'bythenumbers.js' %}"></script>
<script defer src="{% asset_for_js 'election-lookup.js' %}"></script>
<script>
  {% comment %}
  // We don't want the homepage to have any query parameters #}
  // but election-search wants to add them
  {% endcomment %}
function scrubURI() {
  const uri = window.location.href.toString();
  if (uri.indexOf('?') > 0) {
    window.history.replaceState(
      {},
      document.title,
      window.location.href.split('?')[0]
    );
  }
}
{% comment %}
// After all the files are loaded and ready,
{% endcomment %}
window.addEventListener('load', () => {
  {% comment %}
  // Let's remove any query params after the page
  {% endcomment %}
  scrubURI();

  {% comment %}
  // and make sure no interactive elements add a query param
  {% endcomment %}
  let inputs = document.querySelectorAll('#main input, #main select');
  inputs.forEach(element => {
    element.addEventListener('change', scrubURI);
  });

  {% comment %}
  // Set the default office value
  {% endcomment %} 
  let offices = document.querySelectorAll('.js-office');
  offices.forEach(element => {
    element.value = 'S';
  });

  {% comment %}
  // Set the default election cycle
  {% endcomment %}
  let years = document.querySelectorAll('.js-election-year');
  years.forEach(element => {
    element.value = window.DEFAULT_ELECTION_YEAR;
  });

  {% comment %}
  // Set the chart toggle to receipts
  {% endcomment %}
  let toggles = document.querySelectorAll('.js-chart-toggle[value=receipts]');
  toggles.forEach(element => {
    element.checked = true;
  });
});
</script>
{% endblock %}
